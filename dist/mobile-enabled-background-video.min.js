var mvpManager={videoTimeUpdateHandler:null,videoCanPlayHandler:null,windowResizeHandler:null},MobileVideoPlayer=function(i){var e;this.options={framesPerSecond:25,autoplay:!1,audio:!1,loop:!0};for(e in i)this.options[e]=i[e];if(this.video=document.querySelectorAll(this.options.videoTarget)[0],this.canvas=document.querySelectorAll(this.options.canvasTarget)[0],!this.options.videoTarget||!this.video)return void console.error('Please use "videoTarget" property.');if(!this.options.canvasTarget||!this.canvas)return void console.error('Please use "canvasTarget" property.');if(this.options.audio){if("string"==typeof this.options.audio){if(this.audio=document.querySelectorAll(this.options.audio)[0],!this.audio)return void console.error('Element for the "audio" not found')}else this.audio=document.createElement("audio"),this.audio.innerHTML=this.video.innerHTML,this.video.parentNode.insertBefore(this.audio,this.video),this.audio.load();var t=/iPad|iPhone|iPod/.test(navigator.platform);t&&(this.options.autoplay=!1)}this.ctx=this.canvas.getContext("2d"),this.playing=!1,this.resizeTimeoutReference=!1,this.RESIZE_TIMEOUT=1e3,this.init(),this.bind()};MobileVideoPlayer.prototype.init=function(){this.video.load(),this.setCanvasSize()},MobileVideoPlayer.prototype.getOffset=function(i){var e,t,o;if(i)return t=i.getBoundingClientRect(),t.width||t.height||i.getClientRects().length?(o=i.ownerDocument,e=o.documentElement,{top:t.top+window.pageYOffset-e.clientTop,left:t.left+window.pageXOffset-e.clientLeft}):void 0},MobileVideoPlayer.prototype.jumpTo=function(i){this.video.currentTime=this.video.duration*i,this.options.audio&&(this.audio.currentTime=this.audio.duration*i)},MobileVideoPlayer.prototype.bind=function(){var i=this;this.video.addEventListener("timeupdate",mvpManager.videoTimeUpdateHandler=function(){i.drawFrame()}),this.video.addEventListener("canplay",mvpManager.videoCanPlayHandler=function(){i.drawFrame()}),this.video.readyState>=2&&i.drawFrame(),i.options.autoplay&&i.play(),window.addEventListener("resize",mvpManager.windowResizeHandler=function(){clearTimeout(i.resizeTimeoutReference),i.resizeTimeoutReference=setTimeout(function(){i.setCanvasSize(),i.drawFrame()},i.RESIZE_TIMEOUT)}),this.unbind=function(){this.video.removeEventListener("canplay",mvpManager.videoCanPlayHandler),window.removeEventListener("resize",mvpManager.windowResizeHandler),this.options.audio&&this.audio.parentNode.removeChild(this.audio)}},MobileVideoPlayer.prototype.setCanvasSize=function(){this.width=this.canvas.clientWidth,this.height=this.canvas.clientHeight,this.canvas.setAttribute("width",this.width),this.canvas.setAttribute("height",this.height)},MobileVideoPlayer.prototype.play=function(){this.lastTime=Date.now(),this.playing=!0,this.options.audio&&(this.audio.currentTime=this.video.currentTime,this.audio.play())},MobileVideoPlayer.prototype.playPause=function(){this.playing?this.pause():this.play()},MobileVideoPlayer.prototype.pause=function(){this.playing=!1,this.options.audio&&this.audio.pause()},MobileVideoPlayer.prototype.loop=function(){var i=this,e=Date.now(),t=(e-this.lastTime)/1e3;t>=1/this.options.framesPerSecond&&(this.video.currentTime=this.video.currentTime+t,this.lastTime=e,this.audio&&Math.abs(this.audio.currentTime-this.video.currentTime)>.3&&(this.audio.currentTime=this.video.currentTime)),this.video.currentTime>=this.video.duration&&(this.playing=!1,this.options.loop===!0&&(this.video.currentTime=0,i.play())),this.playing?this.animationFrame=requestAnimationFrame(function(){i.loop()}):cancelAnimationFrame(this.animationFrame)},MobileVideoPlayer.prototype.drawFrame=function(){this.ctx.drawImage(this.video,0,0,this.width,this.height)};
